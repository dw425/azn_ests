<!DOCTYPE html>
<html>
<head>
    <title>SQL Runner</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #222; color: #ddd; }
        textarea { width: 100%; height: 150px; background: #333; color: #fff; border: 1px solid #555; padding: 10px; font-family: monospace; font-size: 14px; border-radius: 4px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; margin-top: 10px; border-radius: 4px; font-weight: bold; }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; white-space: pre-wrap; background: #111; padding: 15px; border: 1px solid #444; min-height: 100px; border-radius: 4px; font-family: monospace; }
        .preset { background: #444; color: #fff; border: none; padding: 6px 12px; margin-right: 5px; cursor: pointer; font-size: 12px; border-radius: 4px; margin-bottom: 10px; display: inline-block; }
        .preset:hover { background: #666; }
        h2 { margin-top: 0; color: #fff; border-bottom: 1px solid #444; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h2>üöÄ SQL Command Center</h2>
    
    <div style="margin-bottom: 15px;">
        <button class="preset" onclick="setQuery('SELECT * FROM users ORDER BY user_id DESC LIMIT 5')">Show Recent Users</button>
        <button class="preset" onclick="setQuery('SELECT * FROM stocks ORDER BY symbol ASC')">Show Stocks</button>
        <button class="preset" onclick="setQuery(`SELECT table_name, column_name, data_type \nFROM information_schema.columns \nWHERE table_schema = 'public' \nORDER BY table_name;`)">Show Full Schema</button>
    </div>

    <textarea id="query">SELECT * FROM users LIMIT 5</textarea>
    <br>
    <button onclick="runSQL()">Execute Query</button>
    
    <div id="results">Results will appear here...</div>

    <script>
        // FIXED: Point to the correct backend route defined in adminRoutes.js
        const URL = "https://stock-trading-api-fcp5.onrender.com/api/admin/sql";

        function setQuery(q) {
            document.getElementById('query').value = q;
        }

        async function runSQL() {
            const query = document.getElementById('query').value;
            const resDiv = document.getElementById('results');
            resDiv.innerText = "Running...";
            resDiv.style.color = "#ddd";

            try {
                const res = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                
                const data = await res.json();
                
                if (!res.ok || data.error) {
                    resDiv.innerText = "‚ùå ERROR:\n" + (data.error || res.statusText);
                    resDiv.style.color = "#ff6b6b";
                } else {
                    // Check if it's a SELECT (has rows) or UPDATE/INSERT (rowCount)
                    if (data.rows) {
                        resDiv.innerText = JSON.stringify(data.rows, null, 2);
                    } else {
                        resDiv.innerText = `‚úÖ Success! Rows affected: ${data.rowCount}`;
                    }
                    resDiv.style.color = "#51cf66";
                }
            } catch (err) {
                resDiv.innerText = "Network Error: " + err.message;
                resDiv.style.color = "#ff6b6b";
            }
        }
    </script>
</body>
</html>
