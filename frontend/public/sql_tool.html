<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Command Center</title>
    <style>
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #1e1e1e; color: #f0f0f0; margin: 0; padding: 20px; }
        h1 { border-bottom: 1px solid #333; padding-bottom: 10px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 150px; background: #2d2d2d; color: #0f0; border: 1px solid #444; padding: 10px; font-family: monospace; font-size: 14px; border-radius: 4px; resize: vertical; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 4px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        button:hover { background: #0056b3; }
        #output { margin-top: 20px; background: #252526; padding: 15px; border-radius: 4px; border: 1px solid #333; white-space: pre-wrap; font-family: monospace; min-height: 50px; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .presets { margin-bottom: 15px; display: flex; gap: 10px; }
        .preset-btn { background: #444; font-size: 12px; padding: 5px 10px; cursor: pointer; border: 1px solid #555; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ SQL Command Center (Fixed)</h1>
        
        <div class="presets">
            <button class="preset-btn" onclick="setQuery('SELECT * FROM users')">List All Users</button>
            <button class="preset-btn" onclick="setQuery('SELECT * FROM wallets')">List All Wallets</button>
            <button class="preset-btn" onclick="setQuery(`SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`)">Show Tables</button>
        </div>

        <textarea id="queryInput" placeholder="Enter SQL query here..."></textarea>
        <button onclick="runQuery()">Execute Query</button>
        <div id="output">Results will appear here...</div>
    </div>

    <script>
        // --- THE CRITICAL FIX ---
        // We point explicitly to the BACKEND API, not the Frontend URL.
        const API_URL = 'https://stock-trading-api-fcp5.onrender.com/api/admin/run-sql';

        function setQuery(q) {
            document.getElementById('queryInput').value = q;
        }

        async function runQuery() {
            const query = document.getElementById('queryInput').value;
            const output = document.getElementById('output');
            
            if (!query) return;

            output.innerHTML = 'Running...';
            output.className = '';

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const contentType = res.headers.get("content-type");
                
                // Safety Check: Did we get HTML back? (The "Token <" Error)
                if (contentType && contentType.indexOf("application/json") === -1) {
                    throw new Error("Server Error: Received HTML instead of JSON. The backend URL might be wrong or the server is crashing.");
                }

                const data = await res.json();

                if (res.ok) {
                    output.className = 'success';
                    output.innerText = JSON.stringify(data, null, 2);
                } else {
                    output.className = 'error';
                    output.innerText = `SQL Error: ${data.error}`;
                }
            } catch (err) {
                output.className = 'error';
                output.innerText = `Connection Failed: ${err.message}`;
            }
        }
    </script>
</body>
</html>
